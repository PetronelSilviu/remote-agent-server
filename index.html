<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Remote Agent Dashboard</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background: #f0f2f5; color: #333; margin: 0; padding: 20px; }
        #root { max-width: 800px; margin: 40px auto; padding: 20px; background: white; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        h1, h2 { text-align: center; color: #1c1e21; }
        #device-list { list-style: none; padding: 0; }
        #device-list li { display: flex; justify-content: space-between; align-items: center; padding: 15px; border-bottom: 1px solid #ddd; }
        #device-list li:last-child { border-bottom: none; }
        button { font-size: 14px; background-color: #007bff; color: white; border: none; padding: 10px 15px; border-radius: 6px; cursor: pointer; transition: background-color 0.2s; }
        button:hover { background-color: #0056b3; }
        #status { text-align: center; padding: 10px; color: #606770; }
    </style>
</head>
<body>
    <div id="root">
        <h1>ðŸ“± Remote Agent Dashboard</h1>
        <h2>Registered Devices</h2>
        <div id="status">Loading devices...</div>
        <ul id="device-list">
            </ul>
    </div>

    <script>
        // !!! IMPORTANT: REPLACE WITH YOUR RENDER URL !!!
        const API_URL = 'https://remote-agent-server.onrender.com';

        const statusElement = document.getElementById('status');
        const listElement = document.getElementById('device-list');

        // Function to send a command to a specific device
        async function sendCommand(deviceId, command) {
            try {
                const response = await fetch(`${API_URL}/command`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ deviceId, command })
                });
                const result = await response.json();
                alert(`Command sent to ${deviceId}: ${result.message}`);
            } catch (error) {
                console.error('Error sending command:', error);
                alert('Failed to send command.');
            }
        }

        // Function to fetch all devices and display them
        async function fetchDevices() {
            try {
                const response = await fetch(`${API_URL}/devices`);
                const deviceIds = await response.json();
                listElement.innerHTML = ''; // Clear the list first

                if (deviceIds.length === 0) {
                    statusElement.textContent = 'No devices have registered yet.';
                } else {
                    statusElement.textContent = ''; // Clear status message
                    deviceIds.forEach(id => {
                        const item = document.createElement('li');
                        item.textContent = `Device ID: ${id}`;
                        
                        const restartButton = document.createElement('button');
                        restartButton.textContent = 'Restart App';
                        restartButton.onclick = () => sendCommand(id, 'restart_app');
                        
                        item.appendChild(restartButton);
                        listElement.appendChild(item);
                    });
                }
            } catch (error) {
                console.error('Error fetching devices:', error);
                statusElement.textContent = 'Error loading devices. Is the server running?';
            }
        }

        // Fetch devices when the page loads
        document.addEventListener('DOMContentLoaded', fetchDevices);
    </script>
</body>
</html>
